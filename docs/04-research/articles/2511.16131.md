# AskDB: Unified NL2SQL & Database Administration

**Source:** [AskDB: An LLM Agent for Natural Language Interaction with Relational Databases](https://arxiv.org/html/2511.16131)

## Synthesis
This paper presents **AskDB**, a unified LLM agent that acts as both a **Business Analyst** (Data Analysis) and a **DBA** (Database Administration). It solves the problem that existing tools are either good at Text-to-SQL *or* Admin automation, but not both.

The architecture uses a **ReAct** loop with specific innovations:
1.  **Dynamic Schema-Aware Prompting:** Instead of dumping the whole schema (which confuses LLMs), AskDB first uses a vector search to find relevant table names, then retrieves *only* those schemas, formatted with explicit foreign key constraints.
2.  **Multi-Layered Safety Protocol:**
    *   **Layer 1 (Risk Classification):** Classifies intent as Low/High risk. `DROP TABLE` triggers a mandatory "Action Plan" confirmation.
    *   **Layer 2 (Automated Playbooks):** e.g., "PII Shield" (detects sensitive columns like `user_bio`), "SELECT * Interception" (prevents massive dumps).
3.  **Self-Debugging:** If a query fails, the error is fed back into the ReAct loop as an "observation", allowing the agent to fix syntax errors or bad column names autonomously.

## Core Strategic Ideas
1.  **Schema-Aware RAG:** For large codebases or databases, "dumping everything" is bad. We must use a retrieval step to find *relevant* schemas/definitions before asking the LLM to generate code/SQL.
2.  **Safety as a Protocol:** Security shouldn't be an afterthought. The agent should have a "Risk Classifier" step before *every* action. High-risk actions (delete, drop, force push) require explicit human confirmation.
3.  **Unified Interface:** A single chat interface can handle both "Show me last week's errors" (Analysis) and "Create a new user" (Admin), provided the agent has the right tools and safety checks.

## Integration Plan (Agno + SurrealDB + Gemini 3)
We can adapt AskDB's patterns for a **"Database Manager Agent"** in CodeSwarm:

1.  **Schema Retrieval Tool:**
    *   Store the project's SurrealDB schema in a specialized index.
    *   When a developer asks "Add a field to the User table", the agent first retrieves the *current* definition of the User table using vector search on table names.

2.  **Safety Layer Implementation:**
    *   Implement a `RiskAssessor` middleware in our agent runner.
    *   Before executing `surrealdb.query()`, check if the query contains `REMOVE`, `DELETE`, or `DROP`.
    *   If yes, pause execution and ask the user: "This is a destructive action. Type 'CONFIRM' to proceed."

3.  **Self-Correcting SQL:**
    *   Wrap the `surrealdb.query()` tool in a retry loop.
    *   If SurrealDB returns a syntax error, catch it, feed it back to Gemini 3 with the prompt: "The query failed with error X. Fix it.", and retry (up to 3 times).
