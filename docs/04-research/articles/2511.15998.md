# Abusing MCP for Stealthy C2

**Source:** [Hiding in the AI Traffic: Abusing MCP for LLM-Powered Agentic Red Teaming](https://arxiv.org/html/2511.15998)

## Synthesis
This paper introduces a novel **Command & Control (C2)** architecture for Red Teaming that abuses the **Model Context Protocol (MCP)**.
*   **The Threat:** Traditional C2 (like Cobalt Strike) uses periodic "beacons" that are easily detected by network monitoring.
*   **The Innovation:** The authors replace beacons with **MCP Traffic**.
    *   **Leg 1 (Tasking):** The infected agent connects to a malicious MCP Server (hosted on Cloudflare). This looks like legitimate "AI Tooling" traffic (e.g., Cursor, Copilot).
    *   **Leg 2 (Reasoning):** The agent communicates *directly* with public LLM APIs (e.g., Anthropic) to get attack plans. This traffic is high-reputation, encrypted, and indistinguishable from a developer using an AI assistant.
*   **Capabilities:**
    *   **Event-Driven:** No periodic heartbeats. The agent only talks when it has data or needs a task.
    *   **Swarm Intelligence:** Multiple agents share a "context" via the MCP server. If Agent A finds a credential, Agent B on a different subnet instantly knows about it.
    *   **Polymorphic Payloads:** The LLM generates custom python/bash scripts on-the-fly, avoiding signature-based detection.

## Core Strategic Ideas
1.  **Traffic Camouflage:** CodeSwarm agents could use a similar "MCP-like" protocol for valid reasons. By standardizing on MCP for *all* agent communication (logs, tasks, memory), we create a robust, standard interface that is also naturally firewall-friendly.
2.  **Decoupled Reasoning:** The idea of separating "Tasking" (what to do) from "Reasoning" (how to do it) is powerful.
    *   Tasking: "Fix bug #123" (Small payload).
    *   Reasoning: Sending 100kb of code to Gemini to analyze (Large payload).
    *   This separation allows optimizing costs and latency.
3.  **Swarm Context:** The "Shared Context" database (SQLite in the paper, SurrealDB for us) allows agents to de-conflict. "I am fixing file X" is shared state, preventing another agent from touching file X.

## Integration Plan (Agno + SurrealDB + Gemini 3)
1.  **Adopt MCP Standards:**
    *   We should check if Agno supports MCP natively or if we should write a wrapper.
    *   This allows our agents to potentially interface with external tools (like Cursor or VS Code extensions) that also speak MCP.

2.  **Swarm State in SurrealDB:**
    *   Implement the **"Shared Context"** pattern.
    *   `DEFINE TABLE agent_state SCHEMAFULL;`
    *   `DEFINE FIELD current_task ON agent_state TYPE string;`
    *   `DEFINE FIELD discovered_info ON agent_state TYPE array;`
    *   Before starting a task, an agent queries `agent_state` to see what others have found.

3.  **Security Awareness:**
    *   Since we are building an "Agentic Coding System", we must be aware that our system *looks* like this C2 framework.
    *   We should ensure our agents authenticate via strict mTLS or API keys to prevent unauthorized "Tasking" from external sources (preventing our swarm from being hijacked).
