# CodeSwarm: A Multi-Agent Coding System (ADK-based)

CodeSwarm is a multi-agent system built using the Google Agent Development Kit (ADK). It employs a team of AI agents—Admin, Developer, and Revisor—to collaboratively work on coding projects based on user-defined goals. CodeSwarm leverages Gemini models for all LLM operations and is designed for tasks like code generation, modification, and review.

## Overview

The primary goal of CodeSwarm is to implement a robust multi-agent system that can:
- Understand complex coding goals.
- Break them down into manageable tasks.
- Assign tasks to specialized agents.
- Facilitate code generation and modification.
- Conduct reviews of the generated code.
- Maintain a log of activities and project status.

For detailed project specifications, architecture, and agent roles, please see [docs/project.md](docs/project.md).

## Features

-   **Multi-Agent Collaboration**: Utilizes Admin, Developer, and Revisor agents for a structured and iterative workflow. The AdminAgent also handles logging tasks.
-   **Google ADK Powered**: Built upon the Google ADK framework for direct Gemini model integration and agent orchestration (tested with `google-adk==1.1.1`).
-   **Gemini Models**: Configurable to use specified Gemini models (e.g., `gemini-2.5-flash-preview-05-20`, `gemini-2.5-pro-preview-05-06`, `gemini-2.0-flash` as per `.cursorrules`) for various agent roles via a `.env` file.
-   **Tool-Equipped Agents**: Agents use ADK-native tool calls for operations like file I/O and web browsing, based on assigned `FunctionTool` definitions.
-   **Orchestrator-Managed Workflow**: A central controller manages task distribution, agent invocation, and `session.state` for context sharing.
-   **CLI Controllable**: Initialize projects, define goals, manage rounds, and override models via command-line arguments.
-   **Iterative Development**: Supports multiple rounds of development and review for refining outputs.
-   **Dynamic Project Handling**: Can work within a user-specified project directory.
-   **Knowledge Base Integration**: Designed to leverage a structured Knowledge Base in `codeswarm/prompts/kb/` to enhance agent instructions and performance.
-   **MCP Exploration**: Investigating Model Context Protocol (MCP) for enhanced tool and agent interoperability.

## Project Structure

-   `codeswarm/main_adk_controller.py`: The main orchestration script that manages the agent workflow.
-   `codeswarm/adk_agents/`: Contains agent prompt definitions (JSON files) and agent creation logic.
-   `codeswarm/adk_core/`: Contains tool logic (`tool_logic.py`), ADK FunctionTool definitions, and ADK setup helpers.
-   `codeswarm/adk_config.py`: Loads `.env` variables and provides configuration for agents and tools.
-   `codeswarm/prompts/`: Contains agent system prompt templates.
    -   `kb/`: Subdirectory for the modular Knowledge Base.
-   `.env`: (Must be created manually in the project root) Stores API keys, model names, and the default project path.
-   `docs/`: Contains detailed documentation including:
    -   `project.md`: Overall project specifications and architecture.
    -   `tasklist.md`: Primary planning and task tracking document.
    -   `changelog.log`: Log of major changes.
    -   `codeswarm_development_evolution.md`: History of development, lessons learned.
    -   `advanced_development_patterns.md`: Ideas for future enhancements.
    -   `gitingest/`: Digests of external GitHub repositories for research.
    -   `research/`: Project-specific research documents (e.g., on RAG, MCP).
-   `generated_code/`: Default output directory for code generated by CodeSwarm agents during operation.
-   `project_logs/`: (Intended for logs generated by the CodeSwarm system itself during operation, distinct from `docs/changelog.log`).
-   `.cursorrules`: Mandatory rules and guidelines for AI-assisted development of this project.

## Prerequisites

1.  **Python**: Python 3.10 or higher (Python 3.11 recommended).
2.  **Conda (Recommended)**: For managing environments.
    ```bash
    # Create a new conda environment
    conda create -n codeswarm_env python=3.11
    conda activate codeswarm_env
    ```
3.  **Gemini API Key**: You need an active Gemini API key.
4.  **Required Python Packages**:
    From within your activated conda environment and the project's root directory, install the required packages using the `requirements.txt` file located in the `codeswarm` subdirectory:
    ```bash
    pip install -r codeswarm/requirements.txt
    ```
    This will install key dependencies such as `google-adk[extensions]`, `google-genai`, `python-dotenv`, `requests`, `beautifulsoup4`, and `pydantic`.

## Setup

1.  **Clone the Repository**:
    ```bash
    git clone <repository_url>
    cd codeswarm_project_root
    ```
2.  **Create `.env` File**: In the **project root directory**, create a `.env` file.
    ```env
    # .env
    GEMINI_API_KEY=your_actual_gemini_api_key_here

    # Specify the Gemini models for each agent role (must align with .cursorrules Rule 2.1)
    ADMIN_MODEL=gemini-2.5-flash-preview-05-20
    DEV_MODEL=gemini-2.5-flash-preview-05-20
    REVISOR_MODEL=gemini-2.5-flash-preview-05-20
    # Example for Pro model if needed for a specific agent:
    # SOME_OTHER_AGENT_MODEL=gemini-2.5-pro-preview-05-06

    # Optional: Default project path if not specified via CLI's --path argument.
    DEFAULT_PROJECT_PATH=generated_code/my_default_project

    # Optional: Model temperatures (defaults may be set in adk_config.py if not specified here)
    # ADMIN_TEMPERATURE=0.5
    # DEV_TEMPERATURE=0.7
    # REVISOR_TEMPERATURE=0.4
    ```
    **Note on `DEFAULT_PROJECT_PATH`**: This path is relative to the project root. All file operations by agents are confined within this path.

## Running CodeSwarm

Execute the `main_adk_controller.py` script as a module from the **project root directory**. Ensure your conda environment is activated.

```bash
# (Ensure you are in the project root directory where .env is located)
python -m codeswarm.main_adk_controller --goal "Your project goal here" --path "my_project_subdirectory"
```

**Command-Line Options:**

-   `--goal TEXT`: The overall project goal or initial task description. (Required)
-   `-P TEXT, --path TEXT`: Path to the project directory (relative to project root, or absolute) where agents will work. If it doesn't exist, it might be created. Defaults to `DEFAULT_PROJECT_PATH` from `.env` if set and this option is not provided.
-   `--pairs INTEGER`: Number of Dev/Revisor pairs. Default is 1.
-   `--rounds INTEGER`: Number of development/review rounds. Default is 1.
-   `--model TEXT`: Optional. Override the Gemini model for all agents (must be one of the allowed models in `.cursorrules`).
-   `--help`: Show help message and exit.

**Examples:**

1.  **Start a new project named "calculator_cli" (will be created in `DEFAULT_PROJECT_PATH` if not absolute):**
    ```bash
    python -m codeswarm.main_adk_controller --goal "Create a Python CLI application for a simple calculator" --path "calculator_cli"
    ```

2.  **Work on an existing project (e.g., in `projects/existing_app` relative to project root):**
    ```bash
    python -m codeswarm.main_adk_controller --goal "Refactor the main module and add unit tests" --path "projects/existing_app" --pairs 1 --rounds 2
    ```

## How it Works

CodeSwarm operates through a structured workflow managed by the `main_adk_controller.py` orchestrator:

1.  **Initialization**:
    *   User provides a project goal and parameters via CLI.
    *   Orchestrator initializes agents and the ADK session, using `session.state` for context.
    *   The `target_project_path` is established (based on `--path` or `DEFAULT_PROJECT_PATH`).

2.  **Admin Task Definition (AdminAgent)**:
    *   AdminAgent breaks down the goal into actionable tasks (JSON list). File paths in tasks are absolute, constructed based on `target_project_path`.

3.  **Task Execution Loop (Orchestrator-led)**:
    *   For each task:
        *   **DevAgent Phase**: Generates/modifies code using tools (e.g., `write_file`) with absolute paths.
        *   **RevisorAgent Phase**: Reviews code using tools (e.g., `read_file`).

4.  **Logging (AdminAgent)**:
    *   Updates `docs/changelog.log` and `docs/tasklist.md` within the CodeSwarm project's `docs/` directory.

5.  **Iteration**: Repeats for specified rounds.

## Key Files & Directories

-   `codeswarm/main_adk_controller.py`: Main orchestrator.
-   `codeswarm/adk_config.py`: Loads `.env` configurations.
-   `codeswarm/adk_agents/`: Agent creation logic.
-   `codeswarm/prompts/`: Agent prompt JSON files and `kb/` subdirectory.
-   `codeswarm/adk_core/`: Tool logic, definitions, and ADK setup.
-   `codeswarm/adk_models.py`: Pydantic models for structured agent outputs.
-   `docs/`: All project documentation, including `tasklist.md`, `project.md`, `changelog.log`.
-   `.cursorrules`: AI development guidelines for this project.

## Important Notes

-   **File Path Management**: The `target_project_path` confines all agent file operations.
-   **Tool Usage**: Clear prompts and tool docstrings are crucial.
-   **Session State (`session.state`)**: Critical for inter-agent communication and grounding.
-   **`.cursorrules`**: Adherence to this file is mandatory for all development.

## Further Information

-   **Primary Task List & Roadmap**: [docs/tasklist.md](docs/tasklist.md)
-   **Project Specifications & Architecture**: [docs/project.md](docs/project.md)
-   **Development Changelog**: [docs/changelog.log](docs/changelog.log)
-   **Detailed Technical Evolution & Lessons Learned**: [docs/codeswarm_development_evolution.md](docs/codeswarm_development_evolution.md)
-   **Operational Rules for AI Coders**: [.cursorrules](.cursorrules)

## Roadmap & Future Ideas
Refer to `docs/tasklist.md` for the current detailed roadmap, which includes:
- Enhanced RAG capabilities.
- Sophisticated inter-agent communication.
- MCP integration.
- Advanced KB utilization.